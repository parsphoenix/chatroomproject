<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø§Ù…Ú©Ø§Ù†Ø§Øª ØªÙ…Ø§Ø³</title>
    <link rel="stylesheet" href="assets/fonts.css">
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/chat-fixes.css">
</head>
<body>
    <div class="container">
        <h1>ØªØ³Øª Ø§Ù…Ú©Ø§Ù†Ø§Øª ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ Ùˆ ØªØµÙˆÛŒØ±ÛŒ</h1>
        
        <div class="test-controls">
            <button onclick="testIncomingCall()" class="btn">ØªØ³Øª ØªÙ…Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ</button>
            <button onclick="testVideoCall()" class="btn">ØªØ³Øª ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ</button>
            <button onclick="testAudioCall()" class="btn">ØªØ³Øª ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ</button>
        </div>
        
        <div class="test-controls">
            <button onclick="testMinimize()" class="btn secondary">Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù†</button>
            <button onclick="testMaximize()" class="btn secondary">Ø¨Ø²Ø±Ú¯ Ú©Ø±Ø¯Ù†</button>
            <button onclick="testFullscreen()" class="btn secondary">ØªÙ…Ø§Ù… ØµÙØ­Ù‡</button>
            <button onclick="endCall()" class="btn danger">Ù‚Ø·Ø¹ ØªÙ…Ø§Ø³</button>
        </div>
        
        <div class="test-controls">
            <button onclick="simulateReject()" class="btn warning">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø¯ ØªÙ…Ø§Ø³</button>
            <button onclick="simulateCallEnd()" class="btn warning">Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‚Ø·Ø¹ ØªÙ…Ø§Ø³</button>
            <button onclick="testEnsureFullDisplay()" class="btn info">Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„</button>
        </div>
        
        <div class="device-status" id="deviceStatus"></div>
    </div>

    <!-- Video Call Modal -->
    <div id="videoCallModal" style="display: none !important; visibility: hidden !important;">
        <div class="call-modal">
            <h3 id="callTitle">ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ</h3>
            <div id="callStatus" class="call-status">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø±ÛŒ ØªÙ…Ø§Ø³...</div>
            
            <div class="video-container">
                <div class="video-wrapper">
                    <video id="localVideo" autoplay muted></video>
                    <div class="video-label">Ø´Ù…Ø§</div>
                </div>
                <div class="video-wrapper">
                    <video id="remoteVideo" autoplay></video>
                    <div class="video-label">Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª</div>
                </div>
            </div>
            
            <div class="call-controls">
                <button class="call-control-btn" onclick="toggleMute()" id="muteBtn">
                    ğŸ¤
                </button>
                <button class="call-control-btn" onclick="toggleVideo()" id="videoBtn">
                    ğŸ“¹
                </button>
                <button class="call-control-btn danger" onclick="endCall()">
                    âŒ
                </button>
            </div>
            
            <!-- Ù‚Ø³Ù…Øª Ú†Øª Ø¯Ø± Ø­ÛŒÙ† ØªÙ…Ø§Ø³ -->
            <div class="call-chat-section" id="callChatSection" style="display: none;">
                <div class="call-chat-header">
                    <h4>ğŸ’¬ Ú†Øª Ø¯Ø± Ø­ÛŒÙ† ØªÙ…Ø§Ø³</h4>
                    <button class="toggle-chat-btn" onclick="toggleCallChat()">ğŸ”½</button>
                </div>
                <div class="call-chat-messages" id="callChatMessages">
                    <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ø­ÛŒÙ† ØªÙ…Ø§Ø³ -->
                </div>
                <div class="call-chat-input">
                    <input type="text" id="callMessageInput" placeholder="Ù¾ÛŒØ§Ù… Ø¯Ø± Ø­ÛŒÙ† ØªÙ…Ø§Ø³...">
                    <button class="call-send-btn" onclick="sendCallMessage()">Ø§Ø±Ø³Ø§Ù„</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Incoming Call Modal -->
    <div id="incomingCallModal" class="incoming-call-overlay" style="display: none;">
        <div class="incoming-call-modal">
            <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø³ØªÙ† -->
            <button class="close-incoming-call" onclick="rejectCall()" title="Ø¨Ø³ØªÙ†">Ã—</button>
            
            <div class="incoming-call-header">
                <h3 id="incomingCallTitle">ğŸ“ ØªÙ…Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ</h3>
                <div class="call-type-indicator" id="incomingCallType">ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ</div>
                <div class="call-duration" id="incomingCallDuration">00:00</div>
            </div>
            
            <div class="caller-info">
                <div class="caller-avatar-container">
                    <div class="caller-avatar pulse">T</div>
                    <div class="call-animation"></div>
                    <div class="call-animation-2"></div>
                </div>
                <h4 class="caller-name">Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª</h4>
                <p class="call-status" id="incomingCallStatus">Ø¯Ø± Ø­Ø§Ù„ ØªÙ…Ø§Ø³ Ú¯ÛŒØ±ÛŒ...</p>
                <div class="caller-status">
                    <span class="status-indicator online"></span>
                    <span class="status-text">Ø¢Ù†Ù„Ø§ÛŒÙ†</span>
                </div>
            </div>
            
            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
            <div class="incoming-call-controls">
                <button class="incoming-call-btn reject-btn" onclick="rejectCall()" title="Ø±Ø¯ ØªÙ…Ø§Ø³">
                    <span class="btn-icon">ğŸ“µ</span>
                    <span class="btn-text">Ø±Ø¯</span>
                    <div class="btn-ripple"></div>
                </button>
                
                <button class="incoming-call-btn accept-btn" onclick="acceptCall()" title="Ù¾Ø§Ø³Ø® ØªÙ…Ø§Ø³">
                    <span class="btn-icon">ğŸ“</span>
                    <span class="btn-text">Ù¾Ø§Ø³Ø®</span>
                    <div class="btn-ripple"></div>
                </button>
            </div>
            
            <!-- Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ -->
            <div class="call-options">
                <button class="option-btn audio-only-btn" onclick="acceptCallAudioOnly()" title="Ù¾Ø§Ø³Ø® ÙÙ‚Ø· Ø¨Ø§ ØµØ¯Ø§">
                    <span class="option-icon">ğŸ¤</span>
                    <span class="option-text">ÙÙ‚Ø· ØµØ¯Ø§</span>
                </button>
                
                <button class="option-btn message-btn" onclick="showQuickMessage()" title="Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø³Ø±ÛŒØ¹">
                    <span class="option-icon">ğŸ’¬</span>
                    <span class="option-text">Ù¾ÛŒØ§Ù…</span>
                </button>
                
                <button class="option-btn remind-btn" onclick="remindLater()" title="ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø¨Ø¹Ø¯Ø§Ù‹">
                    <span class="option-icon">â°</span>
                    <span class="option-text">Ø¨Ø¹Ø¯Ø§Ù‹</span>
                </button>
            </div>
            
            <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ -->
            <div class="quick-messages" id="quickMessages" style="display: none;">
                <div class="quick-message-header">
                    <h5>Ù¾ÛŒØ§Ù… Ø³Ø±ÛŒØ¹</h5>
                    <button onclick="hideQuickMessage()">Ã—</button>
                </div>
                <div class="quick-message-options">
                    <button onclick="sendQuickMessage('Ù…Ø´ØºÙˆÙ„Ù…ØŒ Ø¨Ø¹Ø¯Ø§Ù‹ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±')">Ù…Ø´ØºÙˆÙ„Ù…</button>
                    <button onclick="sendQuickMessage('Ø§Ù„Ø§Ù† Ù†Ù…ÛŒâ€ŒØªÙˆÙ†Ù… ØµØ­Ø¨Øª Ú©Ù†Ù…')">Ù†Ù…ÛŒâ€ŒØªÙˆÙ†Ù… ØµØ­Ø¨Øª Ú©Ù†Ù…</button>
                    <button onclick="sendQuickMessage('5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ù‡ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±')">5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¯ÛŒÚ¯Ù‡</button>
                    <button onclick="sendQuickMessage('Ù¾ÛŒØ§Ù…Ú© Ø¨ÙØ±Ø³Øª')">Ù¾ÛŒØ§Ù…Ú© Ø¨ÙØ±Ø³Øª</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Container Ø¨Ø±Ø§ÛŒ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ -->
    <div id="notificationContainer"></div>

    <script src="assets/webrtc.js"></script>
    <script>
        // Ù…ØªØºÛŒØ± global Ø¨Ø±Ø§ÛŒ ØªØ³Øª
        let testWebrtcManager = null;

        // ØªØ³Øª ØªÙ…Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ
        function testIncomingCall() {
            if (!testWebrtcManager) {
                testWebrtcManager = new WebRTCManager('test_user', 'current_user');
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø±ÛŒØ§ÙØª offer Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ
            const fakeOffer = {
                type: 'offer',
                sdp: 'fake-sdp-data'
            };
            
            testWebrtcManager.handleOffer(JSON.stringify(fakeOffer));
        }

        // ØªØ³Øª ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ
        function testVideoCall() {
            if (!testWebrtcManager) {
                testWebrtcManager = new WebRTCManager('test_user', 'current_user');
            }
            
            testWebrtcManager.startVideoCall();
        }

        // ØªØ³Øª ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ
        function testAudioCall() {
            if (!testWebrtcManager) {
                testWebrtcManager = new WebRTCManager('test_user', 'current_user');
            }
            
            testWebrtcManager.startAudioCall();
        }

        // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ³Øª
        function acceptCall() {
            if (testWebrtcManager) {
                testWebrtcManager.acceptCall();
            }
        }

        function acceptCallAudioOnly() {
            if (testWebrtcManager) {
                testWebrtcManager.acceptCallAudioOnly();
            }
        }

        function rejectCall() {
            if (testWebrtcManager) {
                testWebrtcManager.rejectCall();
            }
        }

        function endCall() {
            if (testWebrtcManager) {
                testWebrtcManager.endCall();
            }
        }

        function toggleMute() {
            if (testWebrtcManager) {
                testWebrtcManager.toggleMute();
            }
        }

        function toggleVideo() {
            if (testWebrtcManager) {
                testWebrtcManager.toggleVideo();
            }
        }

        function toggleCallChat() {
            if (testWebrtcManager) {
                testWebrtcManager.toggleCallChat();
            }
        }

        // ØªØ³Øª Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù† Ùˆ Ø¨Ø²Ø±Ú¯ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ø³
        function testMinimize() {
            if (testWebrtcManager) {
                testWebrtcManager.minimizeCall();
            }
        }

        function testMaximize() {
            if (testWebrtcManager) {
                testWebrtcManager.maximizeCall();
            }
        }

        function testFullscreen() {
            if (testWebrtcManager) {
                testWebrtcManager.toggleFullscreen();
            }
        }

        // ØªØ³Øª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø¯ ØªÙ…Ø§Ø³
        function simulateReject() {
            if (testWebrtcManager) {
                testWebrtcManager.handleReject('declined');
            }
        }

        // ØªØ³Øª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‚Ø·Ø¹ ØªÙ…Ø§Ø³
        function simulateCallEnd() {
            if (testWebrtcManager) {
                testWebrtcManager.handleCallEnd();
            }
        }

        // ØªØ³Øª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„
        function testEnsureFullDisplay() {
            if (testWebrtcManager) {
                testWebrtcManager.ensureFullCallDisplay();
            }
        }

        function sendCallMessage() {
            const input = document.getElementById('callMessageInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú†Øª ØªÙ…Ø§Ø³
            addCallMessage(message, true);
            input.value = '';
        }

        function addCallMessage(message, isSent = false) {
            const chatMessages = document.getElementById('callChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `call-message ${isSent ? 'sent' : 'received'}`;
            messageDiv.textContent = message;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹
        function showQuickMessage() {
            const quickMessages = document.getElementById('quickMessages');
            if (quickMessages) {
                quickMessages.style.display = 'block';
            }
        }

        function hideQuickMessage() {
            const quickMessages = document.getElementById('quickMessages');
            if (quickMessages) {
                quickMessages.style.display = 'none';
            }
        }

        function sendQuickMessage(message) {
            alert('Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯: ' + message);
            hideQuickMessage();
            
            // Ø±Ø¯ ØªÙ…Ø§Ø³ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…
            setTimeout(() => {
                rejectCall();
            }, 500);
        }

        function remindLater() {
            alert('Ù¾ÛŒØ§Ù… ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯');
            rejectCall();
        }
    </script>

    <style>
        * {
            font-family: 'Vazir', 'Tahoma', sans-serif !important;
        }

        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }

        .test-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Vazir', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.3);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #4299e1, #3182ce);
        }

        .btn.secondary:hover {
            box-shadow: 0 8px 25px rgba(66,153,225,0.3);
        }

        .btn.danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
        }

        .btn.danger:hover {
            box-shadow: 0 8px 25px rgba(229,62,62,0.3);
        }

        .btn.warning {
            background: linear-gradient(135deg, #ed8936, #c05621);
        }

        .btn.warning:hover {
            box-shadow: 0 8px 25px rgba(237,137,54,0.3);
        }

        .btn.info {
            background: linear-gradient(135deg, #38b2ac, #2c7a7b);
        }

        .btn.info:hover {
            box-shadow: 0 8px 25px rgba(56,178,172,0.3);
        }

        .device-status {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
    </style>
</body>
</html>